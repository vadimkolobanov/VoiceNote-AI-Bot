# handlers/commands.py
from aiogram import Router, types
from aiogram.fsm.context import FSMContext
from aiogram.filters import Command
from aiogram.utils.markdown import hbold  # –î–ª—è MarkdownV2 –≤ /start

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π
from config import MAX_NOTES_MVP, MAX_DAILY_STT_RECOGNITIONS_MVP
from inline_keyboards import get_main_menu_keyboard, \
    PageNavigation  # <--- –ò–ó–ú–ï–ù–ï–ù–ò–ï get_action_keyboard –Ω–∞ get_main_menu_keyboard
from services.common import get_or_create_user

router = Router()


@router.message(Command("start"))
async def cmd_start(message: types.Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start."""
    await state.clear()
    await get_or_create_user(message.from_user)

    # –ò—Å–ø–æ–ª—å–∑—É–µ–º MarkdownV2 –¥–ª—è /start, –µ—Å–ª–∏ —Ö–æ—Ç–∏–º –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    start_text = (
        f"üé§ –ü—Ä–∏–≤–µ—Ç\\! –Ø **VoiceNote AI**, —Ç–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–º–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∑–∞–º–µ—Ç–æ–∫\\.\n\n"
        f"–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ —è:\n"
        f"1\\. –†–∞—Å–ø–æ–∑–Ω–∞—é —Ä–µ—á—å \\(Yandex SpeechKit\\)\\.\n"
        f"2\\. –£–ª—É—á—à—É —Ç–µ–∫—Å—Ç –∏ –∏–∑–≤–ª–µ–∫—É –≤–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Å –ø–æ–º–æ—â—å—é AI \\(DeepSeek\\)\\.\n"
        f"3\\. –ü—Ä–µ–¥–ª–æ–∂—É —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É\\.\n\n"
        f"–ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏–ª–∏ —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–π –≥–æ–ª–æ—Å–æ–≤–æ–µ\\!"
    )
    await message.answer(
        start_text,
        reply_markup=get_main_menu_keyboard(),  # <--- –ò–ó–ú–ï–ù–ï–ù–ò–ï
        parse_mode="MarkdownV2"
    )


@router.message(Command("help"))
async def cmd_help(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help."""
    # –ó–∞–º–µ–Ω–∏—Ç–µ @useranybody –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç –∏–ª–∏ —É–±–µ—Ä–∏—Ç–µ/–∏–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É
    creator_contact = "@useranybody"  # –ü—Ä–∏–º–µ—Ä
    help_text = f"""
üëã –ü—Ä–∏–≤–µ—Ç! –Ø **VoiceNote AI** ‚Äì —Ç–≤–æ–π —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∑–∞–º–µ—Ç–æ–∫.

–Ø –∏—Å–ø–æ–ª—å–∑—É—é —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –æ—Ç –Ø–Ω–¥–µ–∫—Å–∞ (Yandex SpeechKit) –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π AI (DeepSeek) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–∞.

**–í–æ—Ç —á—Ç–æ —è —É–º–µ—é:**

üé§ **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫:**
   - –û—Ç–ø—Ä–∞–≤—å –º–Ω–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
   - –Ø —Ä–∞—Å–ø–æ–∑–Ω–∞—é —Ç–≤–æ—é —Ä–µ—á—å, —É–ª—É—á—à—É —Ç–µ–∫—Å—Ç –∏ –∏–∑–≤–ª–µ–∫—É –≤–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏.
   - –¢–µ–±–µ –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É.
   - –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –¥–µ–π—Å—Ç–≤—É–µ—Ç –ª–∏–º–∏—Ç: **{MAX_NOTES_MVP} –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫**.
   - **{MAX_DAILY_STT_RECOGNITIONS_MVP} —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–π –≥–æ–ª–æ—Å–æ–≤—ã—Ö –≤ –¥–µ–Ω—å**. 

üìù **–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏:**
   - –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "üìù –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é (–∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞ /my_notes).
   - –¢—ã —É–≤–∏–¥–∏—à—å —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö –∑–∞–º–µ—Ç–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º.
   - –ö–∞–∂–¥—É—é –∑–∞–º–µ—Ç–∫—É –º–æ–∂–Ω–æ **—É–¥–∞–ª–∏—Ç—å** –∏–ª–∏ **–ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ**.

üë§ **–ü—Ä–æ—Ñ–∏–ª—å:**
   - –ö–Ω–æ–ø–∫–∞ "üë§ –ü—Ä–æ—Ñ–∏–ª—å" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é –ø–æ–∫–∞–∂–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–±–µ.

ü§ñ **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
   - /start - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
   - /help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.
   - /my_notes - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–∏—Ö –∑–∞–º–µ—Ç–æ–∫.

üí° **–°–æ–≤–µ—Ç—ã:**
   - –ì–æ–≤–æ—Ä–∏ —á–µ—Ç–∫–æ –∏ –≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–∏—Ö–æ–º –º–µ—Å—Ç–µ.
   - –§–æ—Ä–º—É–ª–∏—Ä—É–π –¥–∞—Ç—ã –∏ –∑–∞–¥–∞—á–∏ —è–≤–Ω–æ –¥–ª—è –ª—É—á—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ AI.

---
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –æ—à–∏–±–∫–∏? –°–æ–æ–±—â–∏ –º–æ–µ–º—É —Å–æ–∑–¥–∞—Ç–µ–ª—é: {creator_contact}
"""
    await message.answer(help_text, parse_mode="HTML", disable_web_page_preview=True)