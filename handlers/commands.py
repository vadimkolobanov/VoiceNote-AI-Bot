# handlers/commands.py
from aiogram import Router, types
from aiogram.fsm.context import FSMContext
from aiogram.filters import Command
from aiogram.utils.markdown import hbold

from config import MAX_NOTES_MVP, MAX_DAILY_STT_RECOGNITIONS_MVP
from inline_keyboards import get_main_menu_keyboard, PageNavigation
from services.common import get_or_create_user

router = Router()


@router.message(Command("start"))
async def cmd_start(message: types.Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start."""
    await state.clear()
    await get_or_create_user(message.from_user)

    # --- –ù–û–í–´–ô –¢–ï–ö–°–¢ –°–¢–ê–†–¢–û–í–û–ì–û –°–û–û–ë–©–ï–ù–ò–Ø (–í–ê–†–ò–ê–ù–¢ 2) ---
    start_text = (
        "üéôÔ∏è <b>–ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî VoiceNote AI.</b>\n\n"
        "–Ø –ø—Ä–µ–≤—Ä–∞—â–∞—é –≤–∞—à–∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ –º—ã—Å–ª–∏ –≤ –∏–¥–µ–∞–ª—å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏. "
        "–ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é!\n\n"
        "<b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</b>\n"
        "–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ —è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ:\n\n"
        "1. üîç <b>–†–∞—Å–ø–æ–∑–Ω–∞—é –≤–∞—à—É —Ä–µ—á—å</b> —Å –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é).\n"
        "2. ‚úçÔ∏è <b>–£–ª—É—á—à—É —Ç–µ–∫—Å—Ç:</b> –∏—Å–ø—Ä–∞–≤–ª—é –æ—à–∏–±–∫–∏, —Ä–∞—Å—Å—Ç–∞–≤–ª—é –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è –∏ "
        "–æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é –µ–≥–æ —Å –ø–æ–º–æ—â—å—é AI).\n"
        "3. üéØ <b>–ò–∑–≤–ª–µ–∫—É –≥–ª–∞–≤–Ω–æ–µ:</b> –Ω–∞–π–¥—É –≤ —Ç–µ–∫—Å—Ç–µ –∑–∞–¥–∞—á–∏, –¥–∞—Ç—ã, –∏–º–µ–Ω–∞ –∏ "
        "—Å–æ–∑–¥–∞–º —É–º–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è.\n\n"
        "–ì–æ—Ç–æ–≤—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å? <b>–ó–∞–ø–∏—à–∏—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</b> üëá"
    )

    await message.answer(
        start_text,
        reply_markup=get_main_menu_keyboard(),
        parse_mode="HTML"  # –ò—Å–ø–æ–ª—å–∑—É–µ–º HTML –¥–ª—è –ª—É—á—à–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    )


@router.message(Command("help"))
async def cmd_help(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help."""
    creator_contact = "@useranybody"
    help_text = f"""
üëã –ü—Ä–∏–≤–µ—Ç! –Ø **VoiceNote AI** ‚Äì —Ç–≤–æ–π —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∑–∞–º–µ—Ç–æ–∫.

–Ø –∏—Å–ø–æ–ª—å–∑—É—é —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π AI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–∞.

**–í–æ—Ç —á—Ç–æ —è —É–º–µ—é:**

üé§ **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫:**
   - –û—Ç–ø—Ä–∞–≤—å –º–Ω–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
   - –Ø —Ä–∞—Å–ø–æ–∑–Ω–∞—é —Ç–≤–æ—é —Ä–µ—á—å, —É–ª—É—á—à—É —Ç–µ–∫—Å—Ç –∏ –∏–∑–≤–ª–µ–∫—É –≤–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏.
   - –¢–µ–±–µ –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É.
   - –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –¥–µ–π—Å—Ç–≤—É–µ—Ç –ª–∏–º–∏—Ç: **{MAX_NOTES_MVP} –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫**.
   - **{MAX_DAILY_STT_RECOGNITIONS_MVP} —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–π –≥–æ–ª–æ—Å–æ–≤—ã—Ö –≤ –¥–µ–Ω—å**. 

üìù **–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏:**
   - –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "üìù –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é (–∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞ /my_notes).
   - –¢—ã —É–≤–∏–¥–∏—à—å —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö –∑–∞–º–µ—Ç–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º.
   - –ö–∞–∂–¥—É—é –∑–∞–º–µ—Ç–∫—É –º–æ–∂–Ω–æ **—É–¥–∞–ª–∏—Ç—å**, **–≤—ã–ø–æ–ª–Ω–∏—Ç—å** –∏–ª–∏ **–ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ**.

‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**
   - –í –ü—Ä–æ—Ñ–∏–ª–µ —Ç—ã –º–æ–∂–µ—à—å –∑–∞–π—Ç–∏ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –∏ –≤—Ä–µ–º—è –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é.

üë§ **–ü—Ä–æ—Ñ–∏–ª—å:**
   - –ö–Ω–æ–ø–∫–∞ "üë§ –ü—Ä–æ—Ñ–∏–ª—å" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é –ø–æ–∫–∞–∂–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–±–µ.

ü§ñ **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
   - /start - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
   - /help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.
   - /my_notes - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–∏—Ö –∑–∞–º–µ—Ç–æ–∫.

üí° **–°–æ–≤–µ—Ç—ã:**
   - –ì–æ–≤–æ—Ä–∏ —á–µ—Ç–∫–æ –∏ –≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–∏—Ö–æ–º –º–µ—Å—Ç–µ.
   - –§–æ—Ä–º—É–ª–∏—Ä—É–π –¥–∞—Ç—ã –∏ –∑–∞–¥–∞—á–∏ —è–≤–Ω–æ –¥–ª—è –ª—É—á—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ AI.

---
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –æ—à–∏–±–∫–∏? –°–æ–æ–±—â–∏ –º–æ–µ–º—É —Å–æ–∑–¥–∞—Ç–µ–ª—é: {creator_contact}
"""
    await message.answer(help_text, parse_mode="HTML", disable_web_page_preview=True)