# handlers/info.py
import logging
from aiogram import F, Router, types
from aiogram.fsm.context import FSMContext
from aiogram.utils.markdown import hbold, hitalic, hcode
# --- –ò–ó–ú–ï–ù–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –Ω—É–∂–Ω—ã–π –∏–º–ø–æ—Ä—Ç ---
from aiogram.utils.keyboard import InlineKeyboardBuilder

from inline_keyboards import get_info_keyboard, InfoAction, get_main_menu_keyboard
from config import CREATOR_CONTACT, DONATION_URL

logger = logging.getLogger(__name__)
router = Router()

# –¢–µ–∫—Å—Ç—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
HOW_TO_USE_TEXT = f"""
{hbold("‚ùì –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º")}

1Ô∏è‚É£ {hbold("–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ")}
–ü—Ä–æ—Å—Ç–æ –∑–∞–ø–∏—à–∏—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ. –Ø –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –†–∞—Å–ø–æ–∑–Ω–∞—é —Ä–µ—á—å.
- –ò—Å–ø—Ä–∞–≤–ª—é —Ç–µ–∫—Å—Ç –∏ –∏–∑–≤–ª–µ–∫—É –∏–∑ –Ω–µ–≥–æ –¥–µ—Ç–∞–ª–∏ (–∑–∞–¥–∞—á–∏, –¥–∞—Ç—ã, –º–µ—Å—Ç–∞).
- –ü—Ä–µ–¥–ª–æ–∂—É —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É.

2Ô∏è‚É£ {hbold("–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∑–∞–º–µ—Ç–∫–∞–º–∏")}
- –ù–∞–∂–º–∏—Ç–µ {hitalic("üìù –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏")}, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á.
- –ó–∞–¥–∞—á–∏ —Å –±–ª–∏–∂–∞–π—à–∏–º —Å—Ä–æ–∫–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –Ω–∞–≤–µ—Ä—Ö—É.
- –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é –∑–∞–º–µ—Ç–∫—É, —á—Ç–æ–±—ã {hbold("–ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –∏–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –ø—Ä–æ—Å–ª—É—à–∞—Ç—å –∞—É–¥–∏–æ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å")} –µ–µ.
- –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ {hitalic("üóÑÔ∏è –ê—Ä—Ö–∏–≤")}.

3Ô∏è‚É£ {hbold("–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ —Å–µ–±—è")}
- –í —Ä–∞–∑–¥–µ–ª–µ {hitalic("üë§ –ü—Ä–æ—Ñ–∏–ª—å ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")} –≤—ã –º–æ–∂–µ—Ç–µ:
  - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π {hbold("—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å")} –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏.
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å {hbold("–≤—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é")} (‚≠ê VIP-—Ñ—É–Ω–∫—Ü–∏—è).
  - –í—ã–±—Ä–∞—Ç—å, –∑–∞ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—É—á–∞—Ç—å {hbold("–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è")} (‚≠ê VIP-—Ñ—É–Ω–∫—Ü–∏—è).
"""

VIP_FEATURES_TEXT = f"""
{hbold("‚≠ê –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ VIP-—Å—Ç–∞—Ç—É—Å–∞")}

VIP-—Å—Ç–∞—Ç—É—Å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –≤–∞—à–µ–≥–æ –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–∞:

‚úÖ {hbold("–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è")}
–°–Ω–∏–º–∞—é—Ç—Å—è –≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫ –∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–π —Ä–µ—á–∏.

üß† {hbold("–£–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é")}
–ï—Å–ª–∏ –≤—ã —Å–∫–∞–∑–∞–ª–∏ "–∑–∞–≤—Ç—Ä–∞" –∏–ª–∏ "–≤ –ø—è—Ç–Ω–∏—Ü—É", –Ω–µ —É—Ç–æ—á–Ω–∏–≤ –≤—Ä–µ–º—è, –±–æ—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞ —Ç–æ –≤—Ä–µ–º—è, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã —É–∫–∞–∑–∞–ª–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, 09:00).
{hitalic("–£ Free-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è.")}

üîî {hbold("–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è")}
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∑–∞—Ä–∞–Ω–µ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞ —á–∞—Å –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞), —á—Ç–æ–±—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —Å–æ–±—ã—Ç–∏—é.

‚è∞ {hbold("–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (Snooze)")}
–ù–µ –≥–æ—Ç–æ–≤—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å? –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–û—Ç–ª–æ–∂–∏—Ç—å" –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏, –∏ —è –Ω–∞–ø–æ–º–Ω—é –≤–∞–º –ø–æ–∑–∂–µ.

---
–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π VIP-—Å—Ç–∞—Ç—É—Å, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ {hitalic("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")} –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–æ–π –ø—É–Ω–∫—Ç —Å –ø–æ–º–µ—Ç–∫–æ–π ‚≠ê VIP.
"""

INFO_MAIN_TEXT = f"""
{hbold("‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –ü–æ–º–æ—â—å")}

–ó–¥–µ—Å—å —Å–æ–±—Ä–∞–Ω–∞ –ø–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ.

- {hbold("–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?")} ‚Äî –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º.
- {hbold("VIP-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏")} ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ VIP-—Å—Ç–∞—Ç—É—Å–∞.

–î–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º: {CREATOR_CONTACT}
"""

DONATE_TEXT = f"""
{hbold("‚ù§Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç")}

–ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî VoiceNote AI, –∏ —è —Å—É—â–µ—Å—Ç–≤—É—é –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç—Ä—É–¥—É –æ–¥–Ω–æ–≥–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.

–ï—Å–ª–∏ –±–æ—Ç –æ–∫–∞–∑–∞–ª—Å—è –¥–ª—è –≤–∞—Å –ø–æ–ª–µ–∑–Ω—ã–º –∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–º–æ—á—å –ø—Ä–æ–µ–∫—Ç—É —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –µ–≥–æ –ª—é–±–æ–π –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Å—É–º–º–æ–π. –°–æ–±—Ä–∞–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ–π–¥—É—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ API.

{hbold("–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –¥–æ–Ω–∞—Ç:")}
1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ–Ω–∞—Ç–∞ (–ÆMoney).
2. {hbold("–û–ß–ï–ù–¨ –í–ê–ñ–ù–û:")} –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤–∞—à Telegram ID, —á—Ç–æ–±—ã —è –º–æ–≥ –≤–∞—Å –ø–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—å –∏ –≤—ã–¥–∞—Ç—å VIP-—Å—Ç–∞—Ç—É—Å.

–í–∞—à Telegram ID: {hcode('{user_id}')} (–Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å)

–°–ø–∞—Å–∏–±–æ –≤–∞–º –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É!
"""


@router.callback_query(InfoAction.filter(F.action == "main"))
async def show_info_main(callback: types.CallbackQuery):
    await callback.message.edit_text(INFO_MAIN_TEXT, parse_mode="HTML", reply_markup=get_info_keyboard(),
                                     disable_web_page_preview=True)
    await callback.answer()


@router.callback_query(InfoAction.filter(F.action == "how_to_use"))
async def show_how_to_use(callback: types.CallbackQuery):
    await callback.message.edit_text(HOW_TO_USE_TEXT, parse_mode="HTML", reply_markup=get_info_keyboard())
    await callback.answer()


@router.callback_query(InfoAction.filter(F.action == "vip_features"))
async def show_vip_features(callback: types.CallbackQuery):
    await callback.message.edit_text(VIP_FEATURES_TEXT, parse_mode="HTML", reply_markup=get_info_keyboard())
    await callback.answer()


@router.callback_query(InfoAction.filter(F.action == "donate"))
async def show_donate_info(callback: types.CallbackQuery):
    user_id = callback.from_user.id
    text = DONATE_TEXT.format(user_id=user_id)

    if not DONATION_URL:
        await callback.answer("–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.", show_alert=True)
        return

    # --- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–î–ï–°–¨ ---
    # –£–±–∏—Ä–∞–µ–º types. –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π InlineKeyboardBuilder
    builder = InlineKeyboardBuilder()
    builder.button(text="–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–¥–¥–µ—Ä–∂–∫–µ (–ÆMoney)", url=DONATION_URL)
    builder.button(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data=InfoAction(action="main").pack())

    await callback.message.edit_text(text, parse_mode="HTML", reply_markup=builder.as_markup(),
                                     disable_web_page_preview=True)
    await callback.answer()


# –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é" –∏–∑ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
@router.callback_query(F.data == "go_to_main_menu")
async def back_to_main_menu_from_info(callback: types.CallbackQuery, state: FSMContext):
    await state.clear()
    await callback.message.edit_text("üè† –í—ã –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é.", reply_markup=get_main_menu_keyboard())
    await callback.answer()